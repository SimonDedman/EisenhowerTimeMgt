---
title: "Personal Time Management Dashboard"
subtitle: "Eisenhower Matrix Analysis"
author: "Automated Pipeline"
date: "`r Sys.Date()`"
output:
  html_document:
    theme: flatly
    toc: true
    toc_float: true
    code_folding: hide
    fig_width: 12
    fig_height: 8
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE, 
  message = FALSE, 
  warning = FALSE,
  fig.align = 'center'
)

# Load required libraries
library(ggplot2)
library(dplyr)
library(knitr)
library(DT)

# Load data from saved RDS files
combined_task_data <- readRDS("combined_task_data.rds")
summary_statistics <- readRDS("summary_statistics.rds")

# Source visualization functions to recreate plots
source("../R/visualization.R")

# Recreate plots
eisenhower_plot <- create_eisenhower_plot(
  combined_task_data,
  title = "Eisenhower Matrix - Personal Time Management"
)

timeline_plot <- create_timeline_plot(combined_task_data)
```

# Executive Summary

This dashboard provides an automated analysis of your personal task management using the Eisenhower Matrix approach. Tasks are plotted by urgency (x-axis) vs importance (y-axis), with point size representing duration and color representing enjoyment level.

## Key Metrics

```{r summary-stats}
if (length(summary_statistics) > 0 && !is.null(summary_statistics$overall)) {
  kable(summary_statistics$overall, 
        caption = "Overall Task Statistics",
        col.names = c("Metric", "Value"))
} else {
  cat("No summary statistics available")
}
```

## Data Sources

```{r data-sources}
if (nrow(combined_task_data) > 0) {
  source_summary <- combined_task_data %>%
    group_by(source) %>%
    summarise(
      Tasks = n(),
      `Avg Urgency` = round(mean(urgency_final, na.rm = TRUE), 1),
      `Avg Importance` = round(mean(importance_final, na.rm = TRUE), 1),
      `Total Hours` = round(sum(duration_final, na.rm = TRUE), 1),
      .groups = "drop"
    )
  
  kable(source_summary, caption = "Data by Source")
} else {
  cat("No data available from any sources")
}
```

# Eisenhower Matrix Visualization

The main visualization shows all tasks plotted on the classic Eisenhower Matrix:

- **Do First (Red)**: Urgent and Important
- **Schedule (Blue)**: Important but Not Urgent  
- **Delegate (Orange)**: Urgent but Not Important
- **Eliminate (Gray)**: Neither Urgent nor Important

```{r eisenhower-matrix}
eisenhower_plot
```

## Quadrant Analysis

```{r quadrant-analysis}
if (length(summary_statistics) > 0 && !is.null(summary_statistics$by_quadrant)) {
  quadrant_data <- summary_statistics$by_quadrant %>%
    arrange(desc(count)) %>%
    mutate(
      `% of Tasks` = round(100 * count / sum(count), 1)
    )
  
  kable(quadrant_data, 
        caption = "Task Distribution by Eisenhower Quadrant",
        col.names = c("Quadrant", "Count", "Avg Duration", "Total Duration", "Avg Enjoyment", "% of Tasks"))
} else {
  cat("No quadrant analysis available")
}
```

# Timeline View

This view shows tasks over time based on their due dates:

```{r timeline}
timeline_plot
```

# Detailed Task List

```{r task-table}
if (nrow(combined_task_data) > 0) {
  task_display <- combined_task_data %>%
    select(
      Source = source,
      Task = task_title,
      Urgency = urgency_final,
      Importance = importance_final, 
      Enjoyment = enjoyment_final,
      Duration = duration_final,
      Quadrant = quadrant,
      Status = status,
      Project = project_context
    ) %>%
    arrange(desc(Urgency), desc(Importance))
  
  datatable(
    task_display,
    caption = "Complete Task List",
    options = list(
      pageLength = 15,
      scrollX = TRUE,
      columnDefs = list(
        list(className = 'dt-center', targets = c(2, 3, 4, 5))
      )
    ),
    filter = 'top'
  ) %>%
    formatRound(columns = c("Urgency", "Importance", "Enjoyment", "Duration"), digits = 1)
} else {
  cat("No tasks available to display")
}
```

# Recommendations

```{r recommendations}
if (nrow(combined_task_data) > 0) {
  
  # Calculate some insights
  do_first <- combined_task_data %>% 
    filter(urgency_final >= 5 & importance_final >= 5) %>% 
    nrow()
  
  eliminate <- combined_task_data %>% 
    filter(urgency_final < 5 & importance_final < 5) %>% 
    nrow()
  
  avg_enjoyment_by_quadrant <- combined_task_data %>%
    group_by(quadrant) %>%
    summarise(avg_enjoy = mean(enjoyment_final, na.rm = TRUE), .groups = "drop") %>%
    arrange(desc(avg_enjoy))
  
  total_hours <- sum(combined_task_data$duration_final, na.rm = TRUE)
  
  cat("## Key Insights\n\n")
  
  cat("- **High Priority Tasks**: You have", do_first, "tasks in the 'Do First' quadrant\n")
  cat("- **Potential Elimination**: Consider reviewing", eliminate, "tasks in the 'Eliminate' quadrant\n") 
  cat("- **Total Workload**: Approximately", round(total_hours, 1), "hours of work identified\n")
  
  if (nrow(avg_enjoyment_by_quadrant) > 0) {
    best_quadrant <- avg_enjoyment_by_quadrant$quadrant[1]
    cat("- **Highest Enjoyment**: Tasks in", best_quadrant, "have the highest average enjoyment rating\n")
  }
  
  cat("\n## Action Items\n\n")
  cat("1. Focus on 'Do First' quadrant tasks with high urgency and importance\n")
  cat("2. Schedule dedicated time for 'Schedule' quadrant tasks to prevent them becoming urgent\n") 
  cat("3. Consider delegating or automating tasks in the 'Delegate' quadrant\n")
  cat("4. Evaluate whether tasks in the 'Eliminate' quadrant are truly necessary\n")
  
} else {
  cat("## Setup Required\n\n")
  cat("No task data found. To get started:\n\n")
  cat("1. Add #U[0-10]I[0-10]E[0-10]D[hours]h tags to your Google Calendar events\n")
  cat("2. Set up Trello API credentials (see README)\n") 
  cat("3. Run `targets::tar_make()` to extract and analyze your data\n")
}
```

---

*Report generated automatically on `r Sys.time()` using the targets pipeline. Data refreshes every 6 hours.*